## 1.前置知识

#### RSA算法描述：

RSA算法涉及n、e、d三个参数，其中私钥为n、d，公钥为n、e。n为两个大素数p、q的乘积，ed≡1 (mod φ(n))，φ(n)是n的欧拉函数。

c为密文，m为明文，则加密过程如下：

​                                                                 
$$
c ≡ m^e mod n
$$
解密过程如下：

​                                                                 
$$
m ≡ c^d mod n
$$
解密的关键在于将n分解计算出φ(n)，而n是两个大素数的乘积，这使得解密变得困难。

#### 共模攻击

当攻击者拥有两段使用同一个n加密的密文c1、c2以及两个公钥参数e1、e2时，其总能通过扩展欧几里得算法求解：

​                                                                   
$$
e1*s1+e2*s2=1
$$
解出一组s1、s2，继而通过:

​                                                                              c1^s1 * c2^s2 =m

解出明文（具体过程略）。

## 2.脚本

```python
from libnum import n2s
from gmpy2 import invert

# 欧几里得算法
def egcd(a, b):
  if a == 0:
    return (b, 0, 1)
  else:
    g, y, x = egcd(b % a, a)
    return (g, x - (b // a) * y, y)

def main():
  n = 27560959918385616419486273009594513460044316476337842585463553105701869531698366304637678008602799005181601310816935394003041930445509801196554897781529962616349442136039951911764620999116915741924245788988332766182305635804754798018489793066811741026902011980807157882639313892932653620491354630354060462594865874663773934670618930504925812833202047183166423043264815905853486053255310346030416687430724204177468176762512566055165798172418622268751968793997676391170773216291607752885987933866163158257336522567086228092863302685493888839866559622429685925525799985062044536032584132602747754107800116960090941957657
  c1 = 21823306870841016169952481786862436752894840403702198056283357605213928505593301063582851595978932538906067287633295577036042158302374948726749348518563038266373826871950904733691046595387955703305846728530987885075910490362453202598654326947224392718573893241175123285569008519568745153449344966513636585290770127055273442962689462195231016899149101764299663284434805817339348868793709084130862028614587704503862805479792184019334567648078767418576316170976110991128933886639402771294997811025942544455255589081280244545901394681866421223066422484654301298662143648389546410087950190562132305368935595374543145047531
  c2 = 9206260935066257829121388953665257330462733292786644374322218835580114859866206824679553444406457919107749074087554277542345820215439646770680403669560474462369400641865810922332023620699210211474208020801386285068698280364369889940167999918586298280468301097349599560130461998493342138792264005228209537462674085410740693861782834212336781821810115004115324470013999092462310414257990310781534056807393206155460371454836230410545171068506044174001172922614805135260670524852139187370335492876094059860576794839704978988507147972109411033377749446821374195721696073748745825273557964015532261000826958288349348269664
  e1 = 464857
  e2 = 190529
  s = egcd(e1, e2)
  s1 = s[1]
  s2 = s[2]
  # 求模反元素
  if s1<0:
    s1 = - s1
    c1 = invert(c1, n)
  elif s2<0:
    s2 = - s2
    c2 = invert(c2, n)

  m = pow(c1,s1,n)*pow(c2,s2,n) % n
  # 明文转字符串
  print (n2s(m))
  

if __name__ == '__main__':
  main()
```

